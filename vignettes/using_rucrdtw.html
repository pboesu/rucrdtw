<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Philipp Boersch-Supan" />

<meta name="date" content="2016-11-06" />

<title>Using rucrdtw</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using rucrdtw</h1>
<h4 class="author">Philipp Boersch-Supan</h4>
<h4 class="date">2016-11-06</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Dynamic Time Warping (DTW) methods provide algorithms to optimally map a given time series onto all or part of another time series <span class="citation">(Berndt and Clifford 1994)</span>. The remaining cumulative distance between the series after the alignment is a useful distance metric in time series data mining applications for tasks such as classification, clustering, and anomaly detection.</p>
<p>Calculating a DTW alignment is computationally relatively expensive, and as a consequence DTW is often a bottleneck in time series data mining applications. The <a href="http://www.cs.ucr.edu/~eamonn/UCRsuite.html">UCR Suite</a> <span class="citation">(Rakthanmanon et al. 2012)</span> provides a highly optimized algorithm for best-match subsequence searches that avoids unnecessary distance computations and thereby enables fast DTW and Euclidean Distance queries even in data sets containing trillions of observations.</p>
<p>A broad suite of DTW algorithms is implemented in R in the <a href="https://CRAN.R-project.org/package=dtw"><code>dtw</code> package</a> <span class="citation">(Giorgino 2009)</span>. The <code>rucrdtw</code> R package provides complementary functionality for fast similarity searches by providing R bindings for the UCR Suite via <code>Rcpp</code> <span class="citation">(Eddelbuettel and Francois 2011)</span>. In addition to queries and data stored in text files, <code>rucrdtw</code> also implements methods for queries and/or data that are held in memory as R objects, as well as a method to do fast similarity searches against reference libraries of time series.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>Install <code>rucrdtw</code> from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;pboesu/rucrdtw&quot;</span>)</a></code></pre></div>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>Load <code>rucrdtw</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(<span class="st">&quot;rucrdtw&quot;</span>)</a></code></pre></div>
<p>create a random long time series</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">rwalk &lt;-<span class="st"> </span><span class="kw">cumsum</span>(<span class="kw">runif</span>(<span class="fl">1e7</span>, <span class="dt">min =</span> <span class="fl">-0.5</span>, <span class="dt">max =</span> <span class="fl">0.5</span>))</a></code></pre></div>
<p>Pick a random subsequence of 100 elements as a query</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">qstart &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">length</span>(rwalk), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-2" title="2">query &lt;-<span class="st"> </span>rwalk[qstart<span class="op">:</span>(qstart<span class="op">+</span><span class="dv">100</span>)]</a></code></pre></div>
<p>Since both query and data are R vectors, we use the vector-vector methods for the search.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">system.time</span>(dtw_search &lt;-<span class="st"> </span><span class="kw">ucrdtw_vv</span>(<span class="dt">data =</span> rwalk, <span class="dt">query =</span> query, <span class="dt">dtwwindow =</span> <span class="fl">0.05</span>))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##    1.59    0.00    1.61</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">all.equal</span>(qstart, dtw_search<span class="op">$</span>location)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">system.time</span>(ed_search &lt;-<span class="st"> </span><span class="kw">ucred_vv</span>(<span class="dt">data =</span> rwalk, <span class="dt">query =</span> query))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##    1.61    0.01    1.65</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">all.equal</span>(qstart, ed_search<span class="op">$</span>location)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>And in a matter of seconds we have searched 10 million data points and rediscovered our query!</p>
<p>Searching for an exact match, however, is somewhat artificial. The real power of the similarity search is finding structurally similar subsequences in complex sets of time series. To demonstrate this we load an example data set:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">data</span>(<span class="st">&quot;synthetic_control&quot;</span>)</a></code></pre></div>
<p>This data set contains 600 time series of length 60 from 6 classes <span class="citation">(Alcock et al. 1999)</span>. The data set documentation contains further information about these data. It can be displayed using the command <code>?synthetic_control</code>. We can plot an example of each class</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb14-2" title="2">    <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb14-3" title="3">classes =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Cyclic&quot;</span>, <span class="st">&quot;Increasing&quot;</span>, <span class="st">&quot;Decreasing&quot;</span>, <span class="st">&quot;Upward shift&quot;</span>, <span class="st">&quot;Downward shift&quot;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>){</a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="kw">plot</span>(synthetic_control[i<span class="op">*</span><span class="dv">100-99</span>,], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span>classes[i])</a>
<a class="sourceLine" id="cb14-6" title="6">}</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Since we are now comparing a query against a set of time series, we only need to do comparisons for non-overlapping data sequences. The matrix-vector methods <code>ucrdtw_mv</code> and <code>ucred_mv</code> provide this functionality.</p>
<p>We can demonstrate this by removing a query from the data set, and then searching for a closest match:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">index &lt;-<span class="st"> </span><span class="dv">600</span></a>
<a class="sourceLine" id="cb15-2" title="2">query &lt;-<span class="st"> </span>synthetic_control[index,]</a>
<a class="sourceLine" id="cb15-3" title="3"></a>
<a class="sourceLine" id="cb15-4" title="4">dtw_search &lt;-<span class="st"> </span><span class="kw">ucrdtw_mv</span>(synthetic_control[<span class="op">-</span>index,], query, <span class="fl">0.05</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-5" title="5">ed_search &lt;-<span class="st"> </span><span class="kw">ucred_mv</span>(synthetic_control[<span class="op">-</span>index,], query, <span class="dt">byrow=</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>And plot the results:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">plot</span>(synthetic_control[dtw_search<span class="op">$</span>location,], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">55</span>), <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">lines</span>(query, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">lines</span>(synthetic_control[ed_search<span class="op">$</span>location,], <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">lwd=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;query&quot;</span>, <span class="st">&quot;DTW match&quot;</span>, <span class="st">&quot;ED match&quot;</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="comparison-with-a-naive-dtw-sub-sequence-search" class="section level2">
<h2>Comparison with a naive DTW sub-sequence search</h2>
<p>We can compare the speed-up achieved with the UCR algorithm by comparing it to a naive sliding-window comparison with the <code>dtw</code> function from the <a href="https://CRAN.R-project.org/package=dtw"><code>dtw</code> package</a> <span class="citation">(Giorgino 2009)</span>. We create another time series and load <code>dtw</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb17-2" title="2">rwalk &lt;-<span class="st"> </span><span class="kw">cumsum</span>(<span class="kw">runif</span>(<span class="fl">5e3</span>, <span class="dt">min =</span> <span class="fl">-0.5</span>, <span class="dt">max =</span> <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb17-3" title="3">qstart &lt;-<span class="st"> </span><span class="dv">876</span></a>
<a class="sourceLine" id="cb17-4" title="4">query &lt;-<span class="st"> </span>rwalk[qstart<span class="op">:</span>(qstart<span class="op">+</span><span class="dv">99</span>)]</a>
<a class="sourceLine" id="cb17-5" title="5"><span class="kw">library</span>(dtw)</a></code></pre></div>
<p><code>ucrdtw</code> uses a Sakoe-Chiba Band for the DTW calculation. We therefore create a small function that executes a sliding window search using the same DTW criteria.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">naive_dtw &lt;-<span class="st"> </span><span class="cf">function</span>(data, query){</a>
<a class="sourceLine" id="cb18-2" title="2">  n_comps &lt;-<span class="st"> </span>(<span class="kw">length</span>(data)<span class="op">-</span><span class="kw">length</span>(query)<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb18-3" title="3">  dtw_dist &lt;-<span class="st"> </span><span class="kw">numeric</span>(n_comps)</a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_comps){</a>
<a class="sourceLine" id="cb18-5" title="5">    dtw_dist[i] &lt;-<span class="st"> </span><span class="kw">dtw</span>(query, data[i<span class="op">:</span>(i<span class="op">+</span><span class="kw">length</span>(query)<span class="op">-</span><span class="dv">1</span>)], <span class="dt">distance.only =</span> <span class="ot">TRUE</span>, <span class="dt">window.type=</span><span class="st">&quot;sakoechiba&quot;</span>, <span class="dt">window.size=</span><span class="dv">5</span>)<span class="op">$</span>distance</a>
<a class="sourceLine" id="cb18-6" title="6">  }</a>
<a class="sourceLine" id="cb18-7" title="7">  <span class="kw">which.min</span>(dtw_dist)</a>
<a class="sourceLine" id="cb18-8" title="8">}</a></code></pre></div>
<p>Finally, we run the comparison across three time-series ranging from 1000 to 5000 elements, and plot the result. This comparisons requires the <code>rbenchmark</code> package.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="cf">if</span>(<span class="kw">require</span>(rbenchmark)){</a>
<a class="sourceLine" id="cb19-2" title="2">benchmarks &lt;-<span class="st"> </span>rbenchmark<span class="op">::</span><span class="kw">benchmark</span>(</a>
<a class="sourceLine" id="cb19-3" title="3">  <span class="dt">naive_1000 =</span> <span class="kw">naive_dtw</span>(rwalk[<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>], query),</a>
<a class="sourceLine" id="cb19-4" title="4">  <span class="dt">naive_2000 =</span> <span class="kw">naive_dtw</span>(rwalk[<span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>], query),</a>
<a class="sourceLine" id="cb19-5" title="5">  <span class="dt">naive_5000 =</span> <span class="kw">naive_dtw</span>(rwalk, query),</a>
<a class="sourceLine" id="cb19-6" title="6">  <span class="dt">ucrdtw_1000 =</span> <span class="kw">ucrdtw_vv</span>(rwalk[<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>], query, <span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb19-7" title="7">  <span class="dt">ucrdtw_2000 =</span> <span class="kw">ucrdtw_vv</span>(rwalk[<span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>], query, <span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb19-8" title="8">  <span class="dt">ucrdtw_5000 =</span> <span class="kw">ucrdtw_vv</span>(rwalk, query, <span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb19-9" title="9">  <span class="dt">replications =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb19-10" title="10"></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="co">#ensure benchmark test column is of type factor for compatibility with r-devel</span></a>
<a class="sourceLine" id="cb19-12" title="12">benchmarks<span class="op">$</span>test &lt;-<span class="st"> </span><span class="kw">as.factor</span>(benchmarks<span class="op">$</span>test)</a>
<a class="sourceLine" id="cb19-13" title="13"></a>
<a class="sourceLine" id="cb19-14" title="14">colors &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;#33a02c&quot;</span>,<span class="st">&quot;#1f78b4&quot;</span>), <span class="dt">each=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb19-15" title="15"></a>
<a class="sourceLine" id="cb19-16" title="16"><span class="co">#plot with log1p transformed axes, as some execution times may be numerically zero</span></a>
<a class="sourceLine" id="cb19-17" title="17"><span class="kw">plot</span>(<span class="kw">log1p</span>(benchmarks<span class="op">$</span>elapsed<span class="op">*</span><span class="dv">200</span>) <span class="op">~</span><span class="st"> </span>benchmarks<span class="op">$</span>test, <span class="dt">cex.axis=</span><span class="fl">0.7</span>, <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;execution time [ms]&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="dt">medcol =</span> colors, <span class="dt">staplecol=</span>colors, <span class="dt">boxcol=</span>colors)</a>
<a class="sourceLine" id="cb19-18" title="18"><span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">log1p</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dv">10000</span>)), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dv">10000</span>), <span class="dt">cex.axis =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb19-19" title="19"><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;naive DTW&quot;</span>, <span class="st">&quot;UCR DTW&quot;</span>), <span class="dt">fill =</span> <span class="kw">c</span>(<span class="st">&quot;#33a02c&quot;</span>,<span class="st">&quot;#1f78b4&quot;</span>), <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb19-20" title="20">}</a></code></pre></div>
<pre><code>## Loading required package: rbenchmark</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The speed-up is approximately 3 orders of magnitude.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-alcock1999time">
<p>Alcock, R. J., Y. Manolopoulos, Data Engineering Laboratory, and Department Of Informatics. 1999. “Time-Series Similarity Queries Employing a Feature-Based Approach.” In <em>In 7 Th Hellenic Conference on Informatics, Ioannina</em>, 27–29.</p>
</div>
<div id="ref-berndt1994using">
<p>Berndt, Donald J, and James Clifford. 1994. “Using Dynamic Time Warping to Find Patterns in Time Series.” In <em>KDD Workshop</em>, 10:359–70. 16. AAAI. <a href="http://www.aaai.org/Library/Workshops/1994/ws94-03-031.php">http://www.aaai.org/Library/Workshops/1994/ws94-03-031.php</a>.</p>
</div>
<div id="ref-Rcpp">
<p>Eddelbuettel, Dirk, and Romain Francois. 2011. “Rcpp: Seamless R and C++ Integration.” <em>Journal of Statistical Software</em> 40 (1): 1–18. <a href="https://doi.org/10.18637/jss.v040.i08">https://doi.org/10.18637/jss.v040.i08</a>.</p>
</div>
<div id="ref-giorgino2009computing">
<p>Giorgino, Toni. 2009. “Computing and Visualizing Dynamic Time Warping Alignments in R: The Dtw Package.” <em>Journal of Statistical Software</em> 31 (7): 1–24. <a href="https://doi.org/10.18637/jss.v031.i07">https://doi.org/10.18637/jss.v031.i07</a>.</p>
</div>
<div id="ref-rakthanmanon2012searching">
<p>Rakthanmanon, Thanawin, Bilson Campana, Abdullah Mueen, Gustavo Batista, Brandon Westover, Qiang Zhu, Jesin Zakaria, and Eamonn Keogh. 2012. “Searching and Mining Trillions of Time Series Subsequences Under Dynamic Time Warping.” In <em>Proceedings of the 18th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining</em>, 262–70. ACM. <a href="https://doi.org/10.1145/2339530.2339576">https://doi.org/10.1145/2339530.2339576</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
