<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using rucrdtw • rucrdtw</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using rucrdtw">
<meta property="og:description" content="rucrdtw">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rucrdtw</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/using_rucrdtw.html">Using rucrdtw</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pboesu/rucrdtw/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using rucrdtw</h1>
                        <h4 data-toc-skip class="author">Philipp
Boersch-Supan</h4>
            
            <h4 data-toc-skip class="date">2016-11-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pboesu/rucrdtw/blob/HEAD/vignettes/using_rucrdtw.Rmd" class="external-link"><code>vignettes/using_rucrdtw.Rmd</code></a></small>
      <div class="hidden name"><code>using_rucrdtw.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Dynamic Time Warping (DTW) methods provide algorithms to optimally
map a given time series onto all or part of another time series <span class="citation">(Berndt and Clifford 1994)</span>. The remaining
cumulative distance between the series after the alignment is a useful
distance metric in time series data mining applications for tasks such
as classification, clustering, and anomaly detection.</p>
<p>Calculating a DTW alignment is computationally relatively expensive,
and as a consequence DTW is often a bottleneck in time series data
mining applications. The <a href="http://www.cs.ucr.edu/~eamonn/UCRsuite.html" class="external-link">UCR Suite</a> <span class="citation">(Rakthanmanon et al. 2012)</span> provides a highly
optimized algorithm for best-match subsequence searches that avoids
unnecessary distance computations and thereby enables fast DTW and
Euclidean Distance queries even in data sets containing trillions of
observations.</p>
<p>A broad suite of DTW algorithms is implemented in R in the <a href="https://CRAN.R-project.org/package=dtw" class="external-link"><code>dtw</code>
package</a> <span class="citation">(Giorgino 2009)</span>. The
<code>rucrdtw</code> R package provides complementary functionality for
fast similarity searches by providing R bindings for the UCR Suite via
<code>Rcpp</code> <span class="citation">(Eddelbuettel and Francois
2011)</span>. In addition to queries and data stored in text files,
<code>rucrdtw</code> also implements methods for queries and/or data
that are held in memory as R objects, as well as a method to do fast
similarity searches against reference libraries of time series.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install <code>rucrdtw</code> from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"pboesu/rucrdtw"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Load <code>rucrdtw</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/pboesu/rucrdtw" class="external-link">"rucrdtw"</a></span><span class="op">)</span></span></code></pre></div>
<p>create a random long time series</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">rwalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1e7</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, max <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Pick a random subsequence of 100 elements as a query</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qstart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rwalk</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="va">rwalk</span><span class="op">[</span><span class="va">qstart</span><span class="op">:</span><span class="op">(</span><span class="va">qstart</span><span class="op">+</span><span class="fl">100</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Since both query and data are R vectors, we use the vector-vector
methods for the search.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">dtw_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ucrdtw_vv.html">ucrdtw_vv</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rwalk</span>, query <span class="op">=</span> <span class="va">query</span>, dtwwindow <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   1.423   0.002   1.425</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">qstart</span>, <span class="va">dtw_search</span><span class="op">$</span><span class="va">location</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">ed_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ucred_vv.html">ucred_vv</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rwalk</span>, query <span class="op">=</span> <span class="va">query</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   0.671   0.000   0.670</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">qstart</span>, <span class="va">ed_search</span><span class="op">$</span><span class="va">location</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>And in a matter of seconds we have searched 10 million data points
and rediscovered our query!</p>
<p>Searching for an exact match, however, is somewhat artificial. The
real power of the similarity search is finding structurally similar
subsequences in complex sets of time series. To demonstrate this we load
an example data set:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"synthetic_control"</span><span class="op">)</span></span></code></pre></div>
<p>This data set contains 600 time series of length 60 from 6 classes
<span class="citation">(Alcock et al. 1999)</span>. The data set
documentation contains further information about these data. It can be
displayed using the command <code><a href="../reference/synthetic_control.html">?synthetic_control</a></code>. We can plot
an example of each class</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>    mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal"</span>, <span class="st">"Cyclic"</span>, <span class="st">"Increasing"</span>, <span class="st">"Decreasing"</span>, <span class="st">"Upward shift"</span>, <span class="st">"Downward shift"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">synthetic_control</span><span class="op">[</span><span class="va">i</span><span class="op">*</span><span class="fl">100</span><span class="op">-</span><span class="fl">99</span>,<span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, ylab<span class="op">=</span><span class="st">""</span>, xlab <span class="op">=</span> <span class="st">""</span>, bty<span class="op">=</span><span class="st">"n"</span>, main<span class="op">=</span><span class="va">classes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="using_rucrdtw_files/figure-html/plot-examples-1.png" width="576"></p>
<p>Since we are now comparing a query against a set of time series, we
only need to do comparisons for non-overlapping data sequences. The
matrix-vector methods <code>ucrdtw_mv</code> and <code>ucred_mv</code>
provide this functionality.</p>
<p>We can demonstrate this by removing a query from the data set, and
then searching for a closest match:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fl">600</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="va">synthetic_control</span><span class="op">[</span><span class="va">index</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">dtw_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ucrdtw_mv.html">ucrdtw_mv</a></span><span class="op">(</span><span class="va">synthetic_control</span><span class="op">[</span><span class="op">-</span><span class="va">index</span>,<span class="op">]</span>, <span class="va">query</span>, <span class="fl">0.05</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ed_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ucred_mv.html">ucred_mv</a></span><span class="op">(</span><span class="va">synthetic_control</span><span class="op">[</span><span class="op">-</span><span class="va">index</span>,<span class="op">]</span>, <span class="va">query</span>, byrow<span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>And plot the results:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">synthetic_control</span><span class="op">[</span><span class="va">dtw_search</span><span class="op">$</span><span class="va">location</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">55</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">query</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">synthetic_control</span><span class="op">[</span><span class="va">ed_search</span><span class="op">$</span><span class="va">location</span>,<span class="op">]</span>, col<span class="op">=</span><span class="st">"blue"</span>, lty<span class="op">=</span><span class="fl">3</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"query"</span>, <span class="st">"DTW match"</span>, <span class="st">"ED match"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="using_rucrdtw_files/figure-html/plot-search-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="comparison-with-a-naive-dtw-sub-sequence-search">Comparison with a naive DTW sub-sequence search<a class="anchor" aria-label="anchor" href="#comparison-with-a-naive-dtw-sub-sequence-search"></a>
</h2>
<p>We can compare the speed-up achieved with the UCR algorithm by
comparing it to a naive sliding-window comparison with the
<code>dtw</code> function from the <a href="https://CRAN.R-project.org/package=dtw" class="external-link"><code>dtw</code>
package</a> <span class="citation">(Giorgino 2009)</span>. We create
another time series and load <code>dtw</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">rwalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5e3</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, max <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">qstart</span> <span class="op">&lt;-</span> <span class="fl">876</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="va">rwalk</span><span class="op">[</span><span class="va">qstart</span><span class="op">:</span><span class="op">(</span><span class="va">qstart</span><span class="op">+</span><span class="fl">99</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dynamictimewarping.github.io/" class="external-link">dtw</a></span><span class="op">)</span></span></code></pre></div>
<p><code>ucrdtw</code> uses a Sakoe-Chiba Band for the DTW calculation.
We therefore create a small function that executes a sliding window
search using the same DTW criteria.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_dtw</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">query</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">n_comps</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">dtw_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n_comps</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_comps</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">dtw_dist</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dtw/man/dtw.html" class="external-link">dtw</a></span><span class="op">(</span><span class="va">query</span>, <span class="va">data</span><span class="op">[</span><span class="va">i</span><span class="op">:</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>, distance.only <span class="op">=</span> <span class="cn">TRUE</span>, window.type<span class="op">=</span><span class="st">"sakoechiba"</span>, window.size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">distance</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">dtw_dist</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Finally, we run the comparison across three time-series ranging from
1000 to 5000 elements, and plot the result. This comparisons requires
the <code>rbenchmark</code> package.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://rbenchmark.googlecode.com" class="external-link">rbenchmark</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">benchmarks</span> <span class="op">&lt;-</span> <span class="fu">rbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rbenchmark/man/benchmark.html" class="external-link">benchmark</a></span><span class="op">(</span></span>
<span>  naive_1000 <span class="op">=</span> <span class="fu">naive_dtw</span><span class="op">(</span><span class="va">rwalk</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span>, <span class="va">query</span><span class="op">)</span>,</span>
<span>  naive_2000 <span class="op">=</span> <span class="fu">naive_dtw</span><span class="op">(</span><span class="va">rwalk</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2000</span><span class="op">]</span>, <span class="va">query</span><span class="op">)</span>,</span>
<span>  naive_5000 <span class="op">=</span> <span class="fu">naive_dtw</span><span class="op">(</span><span class="va">rwalk</span>, <span class="va">query</span><span class="op">)</span>,</span>
<span>  ucrdtw_1000 <span class="op">=</span> <span class="fu"><a href="../reference/ucrdtw_vv.html">ucrdtw_vv</a></span><span class="op">(</span><span class="va">rwalk</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span>, <span class="va">query</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  ucrdtw_2000 <span class="op">=</span> <span class="fu"><a href="../reference/ucrdtw_vv.html">ucrdtw_vv</a></span><span class="op">(</span><span class="va">rwalk</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2000</span><span class="op">]</span>, <span class="va">query</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  ucrdtw_5000 <span class="op">=</span> <span class="fu"><a href="../reference/ucrdtw_vv.html">ucrdtw_vv</a></span><span class="op">(</span><span class="va">rwalk</span>, <span class="va">query</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  replications <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#ensure benchmark test column is of type factor for compatibility with r-devel</span></span>
<span><span class="va">benchmarks</span><span class="op">$</span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">benchmarks</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#33a02c"</span>,<span class="st">"#1f78b4"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#plot with log1p transformed axes, as some execution times may be numerically zero</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">benchmarks</span><span class="op">$</span><span class="va">elapsed</span><span class="op">*</span><span class="fl">200</span><span class="op">)</span> <span class="op">~</span> <span class="va">benchmarks</span><span class="op">$</span><span class="va">test</span>, cex.axis<span class="op">=</span><span class="fl">0.7</span>, las <span class="op">=</span> <span class="fl">2</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">"execution time [ms]"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>, medcol <span class="op">=</span> <span class="va">colors</span>, staplecol<span class="op">=</span><span class="va">colors</span>, boxcol<span class="op">=</span><span class="va">colors</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">100</span>,<span class="fl">1000</span>,<span class="fl">10000</span><span class="op">)</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">100</span>,<span class="fl">1000</span>,<span class="fl">10000</span><span class="op">)</span>, cex.axis <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"naive DTW"</span>, <span class="st">"UCR DTW"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#33a02c"</span>,<span class="st">"#1f78b4"</span><span class="op">)</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: rbenchmark</span></span></code></pre>
<p><img src="using_rucrdtw_files/figure-html/run-benchmark-1.png" width="576"></p>
<p>The speed-up is approximately 3 orders of magnitude.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-alcock1999time" class="csl-entry">
Alcock, R. J., Y. Manolopoulos, Data Engineering Laboratory, and
Department Of Informatics. 1999. <span>“Time-Series Similarity Queries
Employing a Feature-Based Approach.”</span> In <em>In 7 Th Hellenic
Conference on Informatics, Ioannina</em>, 27–29.
</div>
<div id="ref-berndt1994using" class="csl-entry">
Berndt, Donald J, and James Clifford. 1994. <span>“Using Dynamic Time
Warping to Find Patterns in Time Series.”</span> In <em>KDD
Workshop</em>, 10:359–70. 16. AAAI.
</div>
<div id="ref-Rcpp" class="csl-entry">
Eddelbuettel, Dirk, and Romain Francois. 2011. <span>“Rcpp: Seamless r
and c++ Integration.”</span> <em>Journal of Statistical Software</em> 40
(1): 1–18. <a href="https://doi.org/10.18637/jss.v040.i08" class="external-link">https://doi.org/10.18637/jss.v040.i08</a>.
</div>
<div id="ref-giorgino2009computing" class="csl-entry">
Giorgino, Toni. 2009. <span>“Computing and Visualizing Dynamic Time
Warping Alignments in <span>R</span>: The Dtw Package.”</span>
<em>Journal of Statistical Software</em> 31 (7): 1–24. <a href="https://doi.org/10.18637/jss.v031.i07" class="external-link">https://doi.org/10.18637/jss.v031.i07</a>.
</div>
<div id="ref-rakthanmanon2012searching" class="csl-entry">
Rakthanmanon, Thanawin, Bilson Campana, Abdullah Mueen, Gustavo Batista,
Brandon Westover, Qiang Zhu, Jesin Zakaria, and Eamonn Keogh. 2012.
<span>“Searching and Mining Trillions of Time Series Subsequences Under
Dynamic Time Warping.”</span> In <em>Proceedings of the 18th
<span>ACM</span> <span>SIGKDD</span> International Conference on
Knowledge Discovery and Data Mining</em>, 262–70. ACM. <a href="https://doi.org/10.1145/2339530.2339576" class="external-link">https://doi.org/10.1145/2339530.2339576</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Philipp Boersch-Supan, Thanawin Rakthanmanon, Bilson Campana, Abdullah Mueen, Gustavo Batista, Eamonn Keogh.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
